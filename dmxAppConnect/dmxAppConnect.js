/*!
 DMXzone App Connect
 Version: 1.2.0
 (c) 2017 DMXzone.com
 @build 2017-10-23 09:35:07
 */
Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var i=arguments[1],r=0;r<n;){var s=e[r];if(t.call(i,s,r,e))return r;r++}return-1}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var i=arguments[1],r=0;r<n;){var s=e[r];if(t.call(i,s,r,e))return s;r++}}}),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(t){if(null==this)throw new TypeError("this is null or not defined");for(var e=Object(this),n=e.length>>>0,i=arguments[1],r=i>>0,s=r<0?Math.max(n+r,0):Math.min(r,n),o=arguments[2],a=void 0===o?n:o>>0,d=a<0?Math.max(n+a,0):Math.min(a,n);s<d;)e[s]=t,s++;return e}}),"function"!=typeof Object.assign&&(Object.assign=function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(n[s]=r[s])}return n}),window.Element&&!Element.prototype.closest&&(Element.prototype.closest=function(t){var e,n=(this.document||this.ownerDocument).querySelectorAll(t),i=this;do for(e=n.length;--e>=0&&n.item(e)!==i;);while(e<0&&(i=i.parentElement));return i}),window.dmx=window.dmx||{},dmx.__components={},dmx.__attributes={before:{},mount:{},mounted:{}},dmx.__formatters={boolean:{},global:{},string:{},number:{},object:{},array:{}},dmx.__adapters={},dmx.__actions={},dmx.config={mapping:{form:"form","button, input[type=button], input[type=submit], input[type=reset]":"button","input[type=radio]":"radio","input[type=checkbox]":"checkbox","input[type=file][multiple]":"input-file-multiple","input[type=file]":"input-file","input[type=number]":"input-number",input:"input",textarea:"textarea","select[multiple]":"select-multiple",select:"select",".checkbox-group":"checkbox-group",".radio-group":"radio-group"}},dmx.reIgnoreElement=/^(script|style)$/i,dmx.rePrefixed=/^dmx-/i,dmx.reExpression=/\{\{(.+?)\}\}/,dmx.reExpressionReplace=/\{\{(.+?)\}\}/g,dmx.reToggleAttribute=/^(checked|selected|disabled|required|hidden|async|autofocus|autoplay|default|defer|multiple|muted|novalidate|open|readonly|reversed|scoped)$/i,dmx.reDashAlpha=/-([a-z])/g,dmx.reUppercase=/[A-Z]/g,dmx.appConnect=function(t,e){if(dmx.app)return alert("App already running!");t=t||document.documentElement,window.onpopstate=function(){dmx.requestUpdate()},window.onhashchange=function(){dmx.requestUpdate()};var n=dmx.Component("app");dmx.app=new n(t),dmx.app.$update(),e&&e()},document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector(':root[dmx-app], [dmx-app], :root[is="dmx-app"], [is="dmx-app"]');t&&dmx.appConnect(t,function(){t.removeAttribute("dmx-app")})}),dmx.useHistory=window.history&&window.history.pushState,dmx.extend=function(){var t={},e=!1,n=0,i=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],n++);for(var r=function(n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e&&"[object Object]"===Object.prototype.toString.call(n[i])?t[i]=dmx.extend(!0,t[i],n[i]):null!=n[i]&&(t[i]=n[i]))};n<i;n++){var s=arguments[n];r(s)}return t},dmx.noop=function(){},dmx.isset=function(t){return void 0!==v},dmx.clone=function(t){return t&&JSON.parse(JSON.stringify(t))},dmx.array=function(t){return null==t?[]:Array.prototype.slice.call(t)},dmx.hashCode=function(t){if(null==t)return 0;var e,n=JSON.stringify(t),i=0;for(e=0;e<n.length;e++)i=(i<<5)-i+n.charCodeAt(e),i&=i;return Math.abs(i)},dmx.randomizer=function(t){return t=+t||0,function(){return t=(9301*t+49297)%233280,t/233280}},dmx.escapeRegExp=function(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")},dmx.validate=function(t){return t.checkValidity()},window.setImmediate?dmx.nextTick=function(t,e){return window.setImmediate(t.bind(e))}:window.postMessage?!function(){var t=[];window.addEventListener("message",function(e){if(e.source===window&&"dmxNextTick"===e.data&&t.length){var n=t.shift();n.fn.call(n.context)}}),dmx.nextTick=function(e,n){t.push({fn:e,context:n}),window.postMessage("dmxNextTick","*")}}():dmx.nextTick=function(t,e){window.setTimeout(t.bind(e),0)},dmx.requestUpdate=function(){var t=!1;return function(){t||(t=!0,dmx.nextTick(function(){t=!1,dmx.app&&dmx.app.$update()}))}}(),dmx.debounce=function(t,e){var n;return function(){var i=Array.prototype.slice.call(arguments);clearTimeout(n),n=setTimeout(function(){t.apply(null,i)},e||0)}},dmx.keyCodes={bs:8,tab:9,enter:13,esc:27,space:32,left:37,up:38,right:39,down:40,delete:46},dmx.eventListener=function(t,e,n,i){var r;i=i||{},t.addEventListener(e,function(t){if((!i.self||t.target===t.currentTarget)&&(!i.ctrl||t.ctrlKey)&&(!i.alt||t.altKey)&&(!i.shift||t.shiftKey)&&(!i.meta||t.metaKey)){if(i.stop&&t.stopPropagation(),i.prevent&&t.preventDefault(),t instanceof KeyboardEvent){var e=[];Object.keys(i).forEach(function(t){var n=parseInt(t,10);n?e.push(n):dmx.keyCodes[t]&&e.push(dmx.keyCodes[t])});for(var s=0;s<e.length;s++)if(t.which!==e[s])return}return i.debounce?(clearTimeout(r),void(r=setTimeout(n.bind(this,t),parseInt(i.debounce,10)||0))):n.call(this,t)}},!!i.capture)},dmx.createClass=function(t,e){var n=function(){t.constructor&&t.constructor.apply(this,arguments)};return e&&e.prototype&&(n.prototype=Object.create(e.prototype)),Object.assign(n.prototype,t),n.prototype.constructor=n,n},dmx.Config=function(t){Object.assign(dmx.config,t)},dmx.Component=function(t,e){if(e){var n=dmx.Component(e.extends)||dmx.BaseComponent;e.initialData=Object.assign({},n.prototype.initialData,e.initialData),e.attributes=Object.assign({},n.prototype.attributes,e.attributes),e.methods=Object.assign({},n.prototype.methods,e.methods),e.events=Object.assign({},n.prototype.events,e.events),e.hasOwnProperty("constructor")||(e.constructor=function(t,e){n.call(this,t,e)}),e.type=t;var i=dmx.createClass(e,n);i.extends=e.extends,dmx.__components[t]=i}return dmx.__components[t]},dmx.Attribute=function(t,e,n){dmx.__attributes[e]||(dmx.__attributes[e]={}),dmx.__attributes[e][t]=n},dmx.Formatters=function(t,e){dmx.__formatters[t]||(dmx.__formatters[t]={});for(var n in e)dmx.__formatters[t][n]=e[n]},dmx.Formatter=function(t,e,n){dmx.__formatters[t]||(dmx.__formatters[t]={}),dmx.__formatters[t][e]=n},dmx.Adapter=function(t,e,n){return dmx.__adapters[t]||(dmx.__adapters[t]={}),n&&(dmx.__adapters[t][e]=n),dmx.__adapters[t][e]},dmx.Action=function(t,e){dmx.__actions[t]=e},function(){var t=function(e){if(!(this instanceof t))return new t(e);if(e instanceof t)return e;if(!e)return this;var n=e.length;if(e.nodeType)this[0]=e,this.length=1;else{if("string"==typeof e)return t(document.querySelectorAll(e));if(n)for(var i=0;i<n;i++)e[i]&&e[i].nodeType&&(this[this.length]=e[i],this.length++)}return this};t.prototype={constructor:t,length:0,addClass:function(t){for(var e=0;e<this.length;e++)this[e].classList.add(t);return this},removeClass:function(t){for(var e=0;e<this.length;e++)this[e].classList.remove(t);return this},toggleClass:function(t){for(var e=0;e<this.length;e++)this[e].classList.toggle(t);return this},hasClass:function(t){return!!this[0]&&this[0].classList.contains(t)},attr:function(t,e){if(1===arguments.length&&"string"==typeof t)return this[0]&&this[0].getAttribute(t);for(var n=0;n<this.length;n++)if(2===arguments.length)this[n].setAttribute(t,e);else for(var i in t)this[n].setAttribute(i,t[i]);return this},removeAttr:function(t){for(var e=0;e<this.length;e++)this[e].removeAttribute(t);return this},prop:function(t,e){if(1===arguments.length&&"string"==typeof t)return this[0]&&this[0][t];for(var n=0;n<this.length;n++)if(2===arguments.length)this[n][t]=e;else for(var i in t)this[n][i]=t[i];return this},css:function(t,e){if(1===arguments.length&&"string"==typeof t)return this[0]&&window.getComputedStyle(this[0],null).getPropertyValue(t);for(var n=0;n<this.length;n++)if(2===arguments.length)this[n].style.setProperty(t,e);else for(var i in t)this[n].style.setProperty(i,t[i]);return this},each:function(t,e){if(!t)return this;for(var n=0;n<this.length;n++)if(t.call(e||this[n],n,this[n])===!1)return this;return this},append:function(){for(var e=0;e<arguments.length;e++)for(var n=t(arguments[e]),i=0;i<n.length;i++)this[0].appendChild(n[i]);return this},appendTo:function(e){return t(e).append(this),this},detach:function(){for(var t=0;t<this.length;t++)this[t].parentNode&&this[t].parentNode.removeChild(this[t]);return this},empty:function(){for(var t=0;t<this.length;t++)this[t].innerHTML="";return this}},dmx.dom={get:function(e){return t(document.getElementById(e))},select:function(e){return t(e)},create:function(e){var n=document.createElement(e);return t(n)},contains:function(t){return document.documentElement.contains(t)},walk:function(t,e,n){if(t){if(e.call(n,t)===!1)return;t.hasChildNodes()&&Array.prototype.slice.call(t.childNodes,0).forEach(function(t){dmx.dom.walk(t,e,n)})}},getAttributes:function(t){var e=[];if(1==t.nodeType)for(var n=0;n<t.attributes.length;n++){var i=t.attributes[n];if(i&&i.specified&&dmx.rePrefixed.test(i.name)){var r=i.name.substr(4),s=null,o={};r.split(".").forEach(function(t,e){if(0===e)r=t;else{var n=t.indexOf(":");n>0?o[t.substr(0,n)]=t.substr(n+1):o[t]=!0}});var a=r.indexOf(":");a>0&&(s=r.substr(a+1),r=r.substr(0,a)),e.push({name:r,fullName:i.name,value:i.value,argument:s,modifiers:o})}}return e},remove:function(t){Array.isArray(t)?t.forEach(function(t){dmx.dom.remove(t)}):t.parentNode&&t.parentNode.removeChild(t)},replace:function(t,e){t.parentNode&&t.parentNode.replaceChild(e,t)}}}(),function(){var t={},e={"{":"L_CURLY","}":"R_CURLY","(":"L_PAREN",")":"R_PAREN","[":"L_BRACKET","]":"R_BRACKET",".":"PERIOD",",":"COMMA",":":"COLON","?":"QUESTION","+":"ADDICTIVE","-":"ADDICTIVE","*":"MULTIPLICATIVE","/":"MULTIPLICATIVE","%":"MULTIPLICATIVE","===":"EQUALITY","!==":"EQUALITY","==":"EQUALITY","!=":"EQUALITY","<":"RELATIONAL",">":"RELATIONAL","<=":"RELATIONAL",">=":"RELATIONAL",in:"RELATIONAL","&&":"LOGICAL_AND","||":"LOGICAL_OR","!":"LOGICAL_NOT","&":"BITWISE_AND","|":"BITWISE_OR","^":"BITWISE_XOR","~":"BITWISE_NOT","<<":"BITWISE_SHIFT",">>":"BITWISE_SHIFT",">>>":"BITWISE_SHIFT"},n={n:"\n",f:"\f",r:"\r",t:"\t",v:"\v","'":"'",'"':'"',"`":"`"},i={in:function(t,e){return t()in e()},"?":function(t,e,n){return t()?e():n()},"+":function(t,e){return t=t(),e=e(),null==t?e:null==e?t:t+e},"-":function(t,e){return t()-e()},"*":function(t,e){return t()*e()},"/":function(t,e){return t()/e()},"%":function(t,e){return t()%e()},"===":function(t,e){return t()===e()},"!==":function(t,e){return t()!==e()},"==":function(t,e){return t()==e()},"!=":function(t,e){return t()!=e()},"<":function(t,e){return t()<e()},">":function(t,e){return t()>e()},"<=":function(t,e){return t()<=e()},">=":function(t,e){return t()>=e()},"&&":function(t,e){return t()&&e()},"||":function(t,e){return t()||e()},"&":function(t,e){return t()&e()},"|":function(t,e){return t()|e()},"^":function(t,e){return t()^e()},"<<":function(t,e){return t()<<e()},">>":function(t,e){return t()>>e()},">>>":function(t,e){return t()>>>e()},"~":function(t){return~t()},"!":function(t){return!t()}},r={this:function(t){return function(){return t.data}},undefined:function(){return function(){}},null:function(){return function(){return null}},true:function(){return function(){return!0}},false:function(){return function(){return!1}}},s=function(){return 0};dmx.lexer=function(i){function r(t){return t>1?i.substr(w,t):i[w]}function s(t){return t=t||1,w+t<i.length&&i[w+t]}function o(t){return t.indexOf(E)!=-1}function a(t){return'"'==t||"'"==t||"`"==t}function d(t){return t>="0"&&t<="9"}function u(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||"_"==t||"$"==t}function h(t){return u(t)||d(t)}function l(t){return" "==t||"\r"==t||"\t"==t||"\n"==t||"\v"==t||" "==t}function c(t){return"-"==t||"+"==t||d(t)}function p(t){var e="",s=!1;for(w++;w<i.length;){if(E=r(),s){if("u"==E){w++;var o=r(4);if(o.match(/[\da-f]{4}/i))throw Error("Invalid unicode escape");e+=String.fromCharCode(parseInt(o,16)),w+=3}else{var a=n[E];e+=a?a:E}s=!1}else if("\\"==E)s=!0;else{if(E==t)return w++,e;e+=E}w++}throw Error("Unterminated quote")}function f(){for(var t="",e=!1;w<i.length;){if(E=r(),o(".")&&s()&&d(s())||d(E))t+=E;else{var n=s();if(o("eE")&&c(n))t+="e",e=!0;else{if(!(c(E)&&n&&d(n)&&e)){if(!c(E)||n&&d(n)||!e)break;throw Error("Invalid exponent")}t+=E,e=!1}}w++}return+t}function m(){for(var t="";w<i.length&&(E=r(),h(E));)t+=E,w++;return t}function v(){var t="",e="",n=!1;for(w++;w<i.length;){if(E=r(),n)n=!1;else if("\\"==E)n=!0;else if("/"==E){for(w++;"ign".indexOf(E=r())!=-1;)e+=E,w++;return t+"%%%"+e}t+=E,w++}throw Error("Unterminated regexp")}function x(){var t=w,e=!0;try{v()}catch(t){e=!1}return w=t,E="/",e}if(t[i])return t[i];for(var g,y,b,E,$,C,A=[],w=0,_=!0;w<i.length;){if(b=w,E=r(),a(E)&&_)y="STRING",g=p(E),_=!1;else if((d(E)||o(".")&&s()&&d(s()))&&_)y="NUMBER",g=f(),_=!1;else if(u(E)&&_)y="IDENT",g=m(),o("(")&&(y="METHOD"),_=!1;else if(o("/")&&_&&x())y="REGEXP",g=v(),_=!1;else{if(l(E)){w++;continue}if((C=r(3))&&e[C])y=e[C],g=C,_=!0,w+=3;else if(($=r(2))&&e[$])y=e[$],g=$,_=!0,w+=2;else{if(!e[E])throw Error("Lexer Error: Unexpected token '"+E+"' at column "+w+" in expression ["+i+"]");y=e[E],g=E,_=!0,w++}}A.push({name:y,index:b,value:g})}return t[i]=A,A},dmx.parse=function(t,e){function n(){if(0===k.length)throw Error("Unexpected end of expression: "+t);return k[0]}function o(t){if(k.length>0){var e=k[0];if(!t||e.name==t)return e}return!1}function a(t){var e=o(t);return!!e&&(k.shift(),e)}function d(e){if(!a(e))throw Error("Unexpected token, expecting ["+e+"]. expression: "+t)}function u(t){var n=Array.prototype.slice.call(arguments,1);return function(){return i.hasOwnProperty(t)?i[t].apply(e,n):t}}function h(){function t(){for(var t,n=0;n<e.length;n++){var i=e[n];i&&(t=i())}return t}for(var e=[];;)return k.length>0&&!o("R_PAREN")&&!o("R_BRACKET")&&e.push(l()),(1==e.length?e[0]:t)()}function l(){return c()}function c(){var t,e,n=p();if(e=a("QUESTION")){if(t=c(),e=a("COLON"))return u("?",n,t,c());throw Error("Parse Error")}return n}function p(){for(var t,e=f();;){if(!(t=a("LOGICAL_OR")))return e;e=u(t.value,e,f())}}function f(){var t,e=m();return(t=a("LOGICAL_AND"))&&(e=u(t.value,e,f())),e}function m(){var t,e=v();return(t=a("BITWISE_OR"))&&(e=u(t.value,e,v())),e}function v(){var t,e=x();return(t=a("BITWISE_XOR"))&&(e=u(t.value,e,x())),e}function x(){var t,e=g();return(t=a("BITWISE_AND"))&&(e=u(t.value,e,x())),e}function g(){var t,e=y();return(t=a("EQUALITY"))&&(e=u(t.value,e,g())),e}function y(){var t,e=b();return(t=a("RELATIONAL"))&&(e=u(t.value,e,y())),e}function b(){for(var t,e=E();t=a("BITWISE_SHIFT");)e=u(t.value,e,E());return e}function E(){for(var t,e=$();t=a("ADDICTIVE");)e=u(t.value,e,$());return e}function $(){for(var t,e=C();t=a("MULTIPLICATIVE");)e=u(t.value,e,C());return e}function C(){var t;return(t=a("ADDICTIVE"))?"+"==t.value?A():u(t.value,s,C()):(t=a("LOGICAL_NOT"))?u(t.value,C()):A()}function A(){var t,i;if(a("L_PAREN"))t=l(),d("R_PAREN");else if(a("L_CURLY")){var s={};if("R_CURLY"!=n().name)do{var h=a().value;d("COLON"),s[h]=l()()}while(a("COMMA"));t=u(s),d("R_CURLY")}else if(a("L_BRACKET")){var c=[];if("R_BRACKET"!=n().name)do c.push(l()());while(a("COMMA"));t=u(c),d("R_BRACKET")}else if(a("PERIOD"))t=o()?O(u(e.data)):u(e.data);else{var p=a();if(p===!1)throw Error("Not a primary expression");t="IDENT"==p.name?r.hasOwnProperty(p.value)?r[p.value](e):function(){return e.get(p.value)}:"METHOD"==p.name?u(dmx.__formatters.global[p.value]||function(){window.warn&&console.warn("Formatter "+p.value+" doesn't exist")}):"REGEXP"==p.name?function(){var t=p.value.split("%%%");return new RegExp(t[0],t[1])}:function(){return p.value}}for(;i=a("L_PAREN")||a("L_BRACKET")||a("PERIOD");)if("("==i.value)t=w(t,T);else if("["==i.value)T=t,t=_(t);else{if("."!=i.value)throw Error("Parse Error");T=t,t=O(t)}return T=null,t}function w(t,i){var r=[];if("R_PAREN"!=n().name)do r.push(l());while(a("COMMA"));return d("R_PAREN"),function(){var n=[];i&&n.push(i());for(var s=0;s<r.length;s++)n.push(r[s]());var o=t()||dmx.noop;return o.apply(e,n)}}function _(t){var e=l();return d("R_BRACKET"),function(){var n=t(),i=e();if("object"==typeof n&&null!=n)return n[i]}}function O(t){var e=a();return function(){var n=t();if("METHOD"==e.name){var i=typeof n;return"object"==i&&(i=Object.prototype.toString.call(n).slice(8,-1).toLowerCase()),"object"==i&&"function"==typeof n["__"+e.value]?n["__"+e.value]:dmx.__formatters[i]&&dmx.__formatters[i][e.value]||function(){null!=n&&console.warn&&console.warn("Formatter "+e.value+" doesn't exist for type "+i)}}return n&&n.hasOwnProperty(e.value)?n[e.value]:void 0}}if(e=e||dmx.app,dmx.reExpression.test(t))return"{{"==t.substr(0,2)&&"}}"==t.substr(-2)&&t.indexOf("{{",2)==-1?dmx.parse(t.substring(2,t.length-2),e):t.replace(dmx.reExpressionReplace,function(t,n){var i=dmx.parse(n,e);return null==i?"":i});var T,k=dmx.lexer(t).slice(0);return h()}}(),dmx.DataScope=function(t,e){return{parent:e||dmx.app,data:t,seed:Math.random(),get:function(t){return this.data.hasOwnProperty(t)?this.data[t]:this.parent?"parent"==t?this.parent.data:this.parent.get(t):void 0}}},dmx.BaseComponent=dmx.createClass({constructor:function(t,e){this.$node=t,this.parent=e,this.bindings={},this.propBindings={},this.children=[],this.listeners={},this.props={},this.data={},this.seed=Math.random(),this.name=t.getAttribute("id")||t.getAttribute("name")||this.type.toLowerCase().replace(/^dmx-/,""),this.name=this.name.replace(/[^\w]/,""),this.$parseAttributes(t),this.$initialData(),this.render(t),this.beforeMount(t)!==!1&&(this.$mount(t),this.$node&&this.$customAttributes("mounted",this.$node),this.dispatchEvent("mount"),this.mounted())},tag:null,initialData:{},attributes:{},methods:{},events:{mount:Event,destroy:Event},render:function(t){if(this.tag){if(this.tag.toUpperCase()!==this.$node.tagName){this.$node=document.createElement(this.tag);for(var e=0;e<t.attributes.length;e++){var n=t.attributes[e];n.specified&&this.$node.setAttribute(n.name,n.value)}this.$node.innerHTML=t.innerHTML}}else this.$node=null;this.$placeholder=document.createComment(" "+this.type+"["+this.name+"] "),dmx.dom.replace(t,this.$placeholder),this.$node&&(this.$node.dmxComponent=this,this.$parse())},beforeMount:dmx.noop,mounted:dmx.noop,beforeUpdate:dmx.noop,update:dmx.noop,updated:dmx.noop,beforeDestroy:dmx.noop,destroyed:dmx.noop,addEventListener:function(t,e){t in this.listeners||(this.listeners[t]=[]),this.listeners[t].push(e)},removeEventListener:function(t,e){if(t in this.listeners)for(var n=this.listeners[t],i=0;i<n.length;i++)if(n[i]===e)return n.splice(i,1),this.removeEventListener(t,e)},dispatchEvent:function(t,e){if("string"==typeof t)try{var n=this.events[t];t=new n(t,e)}catch(n){var i=t;if(t=document.createEvent("Event"),t.initEvent(i,e&&e.bubbles,e&&e.cancelable),!(t instanceof Event))return console.warn("Unknown event "+t,this.events),!1}if(!(t.type in this.listeners))return!0;var r=this.listeners[t.type];t.target=this;for(var s=0;s<r.length;s++)r[s].call(this,t)===!1&&t.preventDefault();return!t.defaultPrevented},$addChild:function(t,e){var n=dmx.__components[t],i=new n(e,this);this.children.push(i),i.name&&this.add(i.name,i.data)},$customAttributes:function(t,e){dmx.dom.getAttributes(e).forEach(function(n){dmx.__attributes[t][n.name]&&(e.removeAttribute(n.fullName),dmx.__attributes[t][n.name].call(this,e,n))},this)},$parse:function(t){t=t||this.$node,t&&(3===t.nodeType&&dmx.reExpression.test(t.nodeValue)&&this.$addBinding(t.nodeValue,function(e,n){t.nodeValue=e}),1===t.nodeType&&(dmx.config.mapping&&Object.keys(dmx.config.mapping).forEach(function(e){dmx.array(t.querySelectorAll(e)).forEach(function(t){t.hasAttribute("is")||t.setAttribute("is","dmx-"+dmx.config.mapping[e])})}),dmx.dom.walk(t,function(t){if(t!=this.$node){if(1===t.nodeType){var e=t.tagName.toLowerCase(),n=dmx.dom.getAttributes(t);if(dmx.reIgnoreElement.test(e))return!1;this.$customAttributes("before",t);var i=n.findIndex(function(t){return"repeat"===t.name});if(i!==-1)return!1;if(t.hasAttribute("is")&&(e=t.getAttribute("is")),dmx.rePrefixed.test(e))return e=e.replace(/^dmx-/i,""),e in dmx.__components?(t.isComponent=!0,this.$addChild(e,t),!1):void console.warn("Unknown component found! "+e);this.$customAttributes("mounted",t)}3===t.nodeType&&dmx.reExpression.test(t.nodeValue)&&this.$addBinding(t.nodeValue,function(e,n){t.nodeValue=e})}},this)))},$update:function(){if(this.beforeUpdate()!==!1){var t=dmx.clone(this.props);this.$updateBindings(this.propBindings),this.$updateBindings(this.bindings),this.update(t),this.children.forEach(function(t){t.$update()}),this.updated()}},$updateBindings:function(t){Object.keys(t).forEach(function(e){var n=t[e],i=dmx.parse(e,this);JSON.stringify(i)!==JSON.stringify(n.value)&&(n.callbacks.forEach(function(t){t.call(this,i,n.value)},this),n.value=dmx.clone(i))},this)},$parseAttributes:function(t){var e=this;this.attributes&&Object.keys(this.attributes).forEach(function(n){var i=e.attributes[n],r=i.default;if(t.hasAttribute(n)&&(i.type==Boolean?r=!0:(r=t.getAttribute(n),i.type==Number&&(r=Number(r)),i.type==String&&(r=String(r)),i.validate&&!i.validate(r)&&(r=i.default)),t.removeAttribute(n)),t.hasAttribute("dmx-bind:"+n)){var s=t.getAttribute("dmx-bind:"+n),o=e.$propBinding(n).bind(e);e.propBindings[s]=e.propBindings[s]||{value:null,callbacks:[]},e.propBindings[s].callbacks.push(o),o.call(e,e.propBindings[s].value),t.removeAttribute("dmx-bind:"+n)}e.props[n]=dmx.clone(r)}),this.events&&Object.keys(this.events).forEach(function(n){t.hasAttribute("on"+n)&&(e.addEventListener(n,Function("event",t.getAttribute("on"+n))),t.removeAttribute("on"+n))}),dmx.dom.getAttributes(t).forEach(function(n){"on"==n.name&&this.events[n.argument]&&(dmx.eventListener(e,n.argument,function(t){var i=dmx.parse(n.value,dmx.DataScope({$event:t},e));if("string"==typeof i)try{i=new Function("event",i).call(this,t)}catch(t){console.warn('Error executing "'+i+'"',t)}return i},n.modifiers),t.removeAttribute(n.fullName))},this)},$propBinding:function(t){var e=this.attributes[t],n=this;return function(i){void 0===i&&(i=e.default),e.type==Boolean&&(i=!!i),e.type==Number&&(i=Number(i)),e.type==String&&(i=String(i)),e.validate&&!e.validate(i)&&(i=e.default),n.props[t]=dmx.clone(i)}},$initialData:function(){Object.assign(this.data,{$type:this.type},"function"==typeof this.initialData?this.initialData():this.initialData),Object.keys(this.methods).forEach(function(t){var e=this;this.data["__"+t]=function(){return e.methods[t].apply(e,Array.prototype.slice.call(arguments,1))}},this)},$mount:function(t){this.$placeholder&&this.$node&&dmx.dom.replace(this.$placeholder,this.$node)},$addBinding:function(t,e){this.bindings[t]=this.bindings[t]||{value:null,callbacks:[]},this.bindings[t].callbacks.push(e),e.call(this,this.bindings[t].value)},$destroy:function(){this.dispatchEvent("destroy"),this.beforeDestroy(),this.$destroyChildren(),this.parent&&this.parent.del(this.name),this.$node&&dmx.dom.remove(this.$node),this.destroyed()},$destroyChildren:function(){this.children.forEach(function(t){t.$destroy()}),this.children=[]},get:function(t,e){return this.data.hasOwnProperty(t)?this.data[t]:this.parent&&e!==!0?"parent"==t?this.parent.data:this.parent.get(t):null},add:function(t,e){this.data[t]?Array.isArray(this.data[t])?this.data[t].push(e):this.data[t]=[this.data[t],e]:this.set(t,e),dmx.requestUpdate()},set:function(t,e){if("object"!=typeof t)JSON.stringify(this.data[t])!==JSON.stringify(e)&&(this.data[t]=e,dmx.requestUpdate());else for(var n in t)this.set(n,t[n])},del:function(t){delete this.data[t],dmx.requestUpdate()}}),dmx.Component("app",{initialData:{query:{}},attributes:{},methods:{},event:{ready:Event,load:Event},render:function(t){this.parseQuery(),this.$parse(),window.addEventListener("load",this.onload.bind(this)),dmx.nextTick(function(){this.dispatchEvent("ready")},this)},update:function(){this.parseQuery()},onload:function(){this.dispatchEvent("load")},parseQuery:function(){var t="";window.location.search?t=window.location.search.substr(1):window.location.hash.indexOf("?")&&(t=window.location.hash.substr(window.location.hash.indexOf("?")+1),t.indexOf("#")&&(t=t.substr(0,t.indexOf("#")))),this.set("query",t.split("&").reduce(function(t,e){var n=e.split("=");return n[0]&&(t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]||"")),t},{}))}}),dmx.Component("form",{tag:"form",attributes:{novalidate:{type:Boolean,default:!1}},methods:{submit:function(){this.submit()},reset:function(){this.reset()},validate:function(){this.validate()}},events:{invalid:Event,submit:Event},render:function(t){dmx.BaseComponent.prototype.render.call(this,t),this.$node.noValidate=!0,this.$node.addEventListener("submit",this.onsubmit.bind(this)),this.$node.addEventListener("reset",dmx.requestUpdate)},submit:function(t){this.props.novalidate||this.validate()?this.dispatchEvent("submit",{cancelable:!0})&&this._submit():(dmx.requestUpdate(),this.dispatchEvent("invalid"))},_submit:function(){this.$node.submit()},reset:function(){this.$node.reset()},validate:function(){return dmx.validate(this.$node)},onsubmit:function(t){t.preventDefault(),this.submit()}}),dmx.Component("form-element",{constructor:function(t,e){this.updateData=dmx.debounce(this.updateData.bind(this)),dmx.BaseComponent.call(this,t,e)},initialData:{value:"",disabled:!1,validationMessage:"",invalid:!1},attributes:{value:{type:String,default:""},disabled:{type:Boolean,default:!1}},methods:{setValue:function(t){this.setValue(t)},focus:function(){this.focus()},disable:function(t){this.disable(t)},validate:function(){this.validate()}},events:{updated:Event},render:function(t){dmx.BaseComponent.prototype.render.call(this,t),this.$node.value=this.props.value,this.$node.disabled=this.props.disabled,this.$node.defaultValue=this.props.value,this.$node.addEventListener("input",this.updateData.bind(this)),this.$node.addEventListener("change",this.updateData.bind(this)),this.$node.addEventListener("invalid",this.updateData.bind(this)),this.set("value",this.props.value),this.set("disabled",this.props.disabled)},update:function(t){JSON.stringify(t.value)!==JSON.stringify(this.props.value)&&(this.$node.defaultValue=this.props.value,this.setValue(this.props.value)),t.disabled!=this.props.disabled&&(this.$node.disabled=this.props.disabled),this.updateData()},updateData:function(t){t&&dmx.validate(this.$node),this.$node.value!==this.data.value&&dmx.nextTick(function(){this.dispatchEvent("updated")},this),this.set("value",this.$node.value),this.set("disabled",this.$node.disabled),this.$node.dirty&&(this.set("invalid",!this.$node.validity.valid),this.set("validationMessage",this.$node.validationMessage))},setValue:function(t){this.$node.value=t,this.updateData()},focus:function(){this.$node.focus()},disable:function(t){this.$node.disabled=t===!0,this.updateData()},validate:function(){dmx.validate(this.$node),this.updateData()}}),dmx.Component("textarea",{extends:"form-element",tag:"textarea",render:function(t){if(!this.props.value){var e=this.$node.value;e.indexOf("{{")!==-1?this.props.value=dmx.parse(e,this):this.props.value=e}dmx.Component("form-element").prototype.render.call(this,t)}}),dmx.Component("input",{extends:"form-element",tag:"input"}),dmx.Component("input-file",{extends:"input",initialData:{file:null},render:function(t){dmx.Component("form-element").prototype.render.call(this,t),this.$node.addEventListener("change",this.onchange.bind(this))},onchange:function(){var t=null;if(this.$node.files.length){var e=this.$node.files[0];t={date:(e.lastModified?new Date(e.lastModified):e.lastModifiedDate).toISOString(),name:e.name,size:e.size,type:e.type,dataUrl:null},e.type.indexOf("image/")===-1||e.reader||(e.reader=new FileReader,e.reader.onload=function(e){t.dataUrl=e.target.result,dmx.requestUpdate()},e.reader.readAsDataURL(e))}this.set("file",t)},setValue:function(){console.warn("Can not set value of a file input!")}}),dmx.Component("input-file-multiple",{extends:"input",initialData:{files:[]},render:function(t){dmx.Component("form-element").prototype.render.call(this,t),this.$node.addEventListener("change",this.onchange.bind(this))},onchange:function(){var t=Array.prototype.slice.call(this.$node.files).map(function(t){var e={date:(t.lastModified?new Date(t.lastModified):t.lastModifiedDate).toISOString(),name:t.name,size:t.size,type:t.type,dataUrl:null};return t.type.indexOf("image/")===-1||t.reader||(t.reader=new FileReader,t.reader.onload=function(t){e.dataUrl=t.target.result,dmx.requestUpdate()},t.reader.readAsDataURL(t)),e});this.set("files",t)},setValue:function(){console.warn("Can not set value of a file input!")}}),dmx.Component("input-number",{extends:"input",render:function(t){dmx.Component("form-element").prototype.render.call(this,t),this.set("value",+this.props.value)},updateData:function(t){t&&dmx.validate(this.$node),this.$node.value!==this.data.value&&dmx.nextTick(function(){this.dispatchEvent("updated")},this),this.set("value",this.$node.value?+this.$node.value:null),this.set("disabled",this.$node.disabled),this.$node.dirty&&(this.set("invalid",!this.$node.validity.valid),this.set("validationMessage",this.$node.validationMessage))}}),dmx.Component("button",{extends:"form-element",tag:"button",attributes:{type:{type:String,default:"button",validate:function(t){return/^(button|submit|reset)$/i.test(t)}}},render:function(t){dmx.Component("form-element").prototype.render.call(this,t),this.$node.type=this.props.type,"INPUT"===t.tagName&&(this.$node.innerText=this.props.value)}}),dmx.Component("radio",{extends:"form-element",initialData:{checked:!1},tag:"input",attributes:{checked:{type:Boolean,default:!1}},methods:{select:function(t){this.select(t)}},render:function(t){dmx.Component("form-element").prototype.render.call(this,t),this.$node.addEventListener("click",this.updateData.bind(this)),this.$node.type="radio",this.$node.checked=this.props.checked,this.set("checked",this.props.checked)},update:function(t){dmx.Component("form-element").prototype.update.call(this,t),t.checked!==this.props.checked&&(this.$node.checked=this.props.checked),this.updateData()},updateData:function(t){dmx.Component("form-element").prototype.updateData.call(this,t),this.set("checked",this.$node.checked)},select:function(t){this.$node.checked=t!==!1}}),dmx.Component("radio-group",{initialData:{value:""},tag:"div",attributes:{value:{type:String,default:""}},methods:{setValue:function(t){this.setValue(t)}},render:function(t){dmx.BaseComponent.prototype.render.call(this,t),this.setValue(this.props.value)},update:function(t){dmx.BaseComponent.prototype.update.call(this,t),t.value!=this.props.value&&(this.updateValue=!0)},updated:function(){this.updateValue&&(this.updateValue=!1,this.setValue(this.props.value,!0));var t=Array.prototype.slice.call(this.$node.querySelectorAll("input[type=radio]")).filter(function(t){return!t.disabled&&t.checked}).map(function(t){return t.value||1});this.set("value",t[0])},setValue:function(t,e){Array.prototype.slice.call(this.$node.querySelectorAll("input[type=radio]")).forEach(function(n){n.checked=n.value==t,e&&(n.defaultChecked=n.checked)})}}),dmx.Component("checkbox",{extends:"form-element",initialData:{checked:!1},tag:"input",attributes:{checked:{type:Boolean,default:!1}},methods:{select:function(t){this.select(t)}},render:function(t){dmx.Component("form-element").prototype.render.call(this,t),this.$node.addEventListener("click",this.updateData.bind(this)),this.$node.type="checkbox",this.$node.checked=this.props.checked,this.set("checked",this.props.checked)},update:function(t){dmx.Component("form-element").prototype.update.call(this,t),
t.checked!==this.props.checked&&(this.$node.checked=this.props.checked),this.updateData()},updateData:function(t){dmx.Component("form-element").prototype.updateData.call(this,t),this.set("checked",this.$node.checked)},select:function(t){this.$node.checked=t!==!1}}),dmx.Component("checkbox-group",{initialData:{value:[]},tag:"div",attributes:{value:{type:Array,default:[]}},methods:{setValue:function(t){this.setValue(t)}},render:function(t){dmx.BaseComponent.prototype.render.call(this,t),this.setValue(this.props.value)},update:function(t){dmx.BaseComponent.prototype.update.call(this,t),JSON.stringify(t.value)!=JSON.stringify(this.props.value)&&(this.updateValue=!0)},updated:function(){this.updateValue&&(this.updateValue=!1,this.setValue(this.props.value));var t=Array.prototype.slice.call(this.$node.querySelectorAll("input[type=checkbox]")).filter(function(t){return!t.disabled&&t.checked}).map(function(t){return t.value||1});this.set("value",t)},setValue:function(t,e){Array.isArray(t)||(t=[t]),Array.prototype.slice.call(this.$node.querySelectorAll("input[type=checkbox]")).forEach(function(n){n.checked=t.indexOf(n.value)>-1,e&&(n.defaultChecked=n.checked)})}}),dmx.Component("select",{extends:"form-element",initialData:{selectedIndex:-1},tag:"select",attributes:{options:{type:Array,default:[]},optionText:{type:String,default:"$value"},optionValue:{type:String,default:"$value"}},methods:{setSelectedIndex:function(t){this.$node.selectedIndex=t,this.updateData()}},render:function(t){this.options=[],this.props.value?this.updateValue=!0:this.props.value=this.$node.value,dmx.BaseComponent.prototype.render.call(this,t),this.$node.disabled=this.props.disabled,this.$node.addEventListener("change",this.updateData.bind(this)),this.$node.addEventListener("invalid",this.updateData.bind(this)),this.renderOptions()},update:function(t){JSON.stringify(t.options)!==JSON.stringify(this.props.options)&&(this.renderOptions(),this.updateValue=!0),JSON.stringify(t.value)!==JSON.stringify(this.props.value)&&(this.updateValue=!0),t.disabled!=this.props.disabled&&(this.$node.disabled=this.props.disabled),this.updateData()},updated:function(){this.updateValue&&(this.updateValue=!1,this.setValue(this.props.value,!0),this.updateData())},updateData:function(t){dmx.Component("form-element").prototype.updateData.call(this,t),this.set("selectedIndex",this.$node.selectedIndex)},setValue:function(t,e){dmx.array(this.$node.options).forEach(function(n){n.selected=n.value===t,e&&(n.defaultSelected=n.selected)})},renderOptions:function(){this.options.splice(0).forEach(function(t){dmx.dom.remove(t)}),Array.isArray(this.props.options)&&this.props.options.forEach(function(t){"object"!=typeof t&&(t={$value:t});var e=document.createElement("option");e.value=dmx.parse(this.props.optionValue,dmx.DataScope(t)),e.innerText=dmx.parse(this.props.optionText,dmx.DataScope(t)),this.options.push(this.$node.appendChild(e))},this)}}),dmx.Component("select-multiple",{extends:"select",initialData:{value:[]},methods:{setSelectedIndex:function(t){this.$node.selectedIndex=t,this.updateData()}},update:function(t){JSON.stringify(t.options)!==JSON.stringify(this.props.options)&&(this.renderOptions(),this.updateValue=!0),JSON.stringify(t.value)!==JSON.stringify(this.props.value)&&(this.updateValue=!0),this.updateData()},updateData:function(){var t=Array.prototype.slice.call(this.$node.options).filter(function(t){return t.selected}).map(function(t){return t.value});JSON.stringify(t)!==JSON.stringify(this.data.value)&&dmx.nextTick(function(){this.dispatchEvent("updated")},this),this.set("value",t),this.set("disabled",this.$node.disabled),this.set("invalid",!this.$node.validity.valid),this.set("validationMessage",this.$node.validationMessage),this.set("selectedIndex",this.$node.selectedIndex)},setValue:function(t,e){Array.isArray(t)||(t=[t]),dmx.array(this.$node.options).forEach(function(n){n.selected=t.indexOf(n.value)>-1,e&&(n.defaultSelected=n.selected)})}}),dmx.Component("value",{initialData:{value:null},attributes:{value:{default:null}},methods:{setValue:function(t){this.set("value",t)}},render:function(){this.set("value",this.props.value)},update:function(t){t.value!==this.props.value&&this.set("value",this.props.value)}}),dmx.Component("repeat",{initialData:{items:[]},attributes:{repeat:{type:[Array,Object,Number],default:[]},key:{type:String,default:""}},events:{update:Event,updated:Event},render:function(t){for(this.prevItems=[],this.childKeys={},this.$template=document.createDocumentFragment();this.$node.hasChildNodes();)this.$template.appendChild(this.$node.firstChild);this.update({repeat:[]})},update:function(t){if(JSON.stringify(t.repeat)!=JSON.stringify(this.props.repeat)){this.dispatchEvent("update"),t.key!==this.props.key&&this._clear();var e=dmx.Component("repeat-item"),n=this.props.repeat,i=[];if(n){if(Array.isArray(n))i=n.map(function(t){return"object"==typeof t?dmx.clone(t):{$value:t}});else switch(typeof n){case"number":for(var r=0;r<n;r++)i.push({$value:r+1});break;case"object":Object.keys(n).forEach(function(t){i.push({$key:t,$value:n[t]})})}i=i.map(function(t,e){return t.$index=e,t})}if(i.length){if(this.props.key&&i[0].hasOwnProperty(this.props.key)&&this.prevItems.length){var s,o,a,d=this.props.key,u=this.prevItems,h=this._clone(i),l=0,c=0,p=u.length-1,f=h.length-1;t:for(;;){for(;u[l][d]===h[c][d];)if(this.childKeys[h[c][d]].set(h[c]),l++,c++,l>p||c>f)break t;for(;u[p][d]===h[f][d];)if(this.childKeys[h[f][d]].set(h[f]),p--,f--,l>p||c>f)break t;if(u[p][d]!==h[c][d]){if(u[l][d]!==h[f][d])break;if(a=f+1,this.childKeys[h[f][d]].set(h[f]),this._moveChild(h[f][d],h[a]&&h[a][d]),l++,f--,l>p||c>f)break}else if(this.childKeys[h[c][d]].set(h[c]),this._moveChild(h[c][d],u[l][d]),p--,c++,l>p||c>f)break}if(l>p)for(a=f+1;c<=f;)this._insertChild(h[c++],h[a]&&h[a][d]);else if(c>f)for(;l<=p;)this._removeChild(u[l++][d]);else{var m=p-l+1,v=f-c+1,x=u,g=new Array(v).fill(-1),y=!1,b=0,E=0;if(v<=4||m*v<=16){for(s=l;s<=p;s++)if(E<v)for(o=c;o<=f;o++)if(u[s][d]===h[o][d]){g[o-c]=s,b>o?y=!0:b=o,this.childKeys[h[o][d]].set(h[o]),E++,x[s]=null;break}}else{var $={};for(s=c;s<=f;s++)$[h[s][d]]=s;for(s=l;s<=p;s++)E<v&&(o=$[u[s][d]],void 0!==o&&(g[o-c]=s,b>o?y=!0:b=o,this.childKeys[h[o][d]].set(h[o]),E++,x[s]=null))}if(m===u.length&&0===E)for(this._clear();c<v;)this._insertChild(h[c++],null);else{for(s=m-E;s>0;)null!==x[l]&&(this._removeChild(u[l][d]),s--),l++;if(y){var C=this._lis(g);for(o=C.length-1,s=v-1;s>=0;s--)g[s]===-1?(b=s+c,a=b+1,this._insertChild(h[b],h[a]&&h[a][d])):o<0||s!==C[o]?(b=s+c,a=b+1,this._moveChild(h[b][d],h[a]&&h[a][d])):o--}else if(E!==v)for(s=v-1;s>=0;s--)g[s]===-1&&(b=s+c,a=b+1,this._insertChild(h[b],h[a]&&h[a][d]))}}}else if(this.children.length>i.length&&this.children.splice(i.length).forEach(function(t){t.$destroy()}),this.children.length&&this.children.forEach(function(t,e){t.set(i[e])}),i.length>this.children.length){for(var A=document.createDocumentFragment(),s=this.children.length;s<i.length;s++){var w=new e(this.$template.cloneNode(!0),this,i[s]);w.$nodes.forEach(function(t){A.appendChild(t),w.$parse(t)}),this.children.push(w)}this.$node.appendChild(A)}}else this._clear();this.props.key&&(this.prevItems=this._clone(i),this.children.forEach(function(t){this.childKeys[t.data[this.props.key]]=t},this)),this.set("items",i),dmx.nextTick(function(){this.dispatchEvent("updated")},this)}},_lis:function(t){var e=t.slice(0),n=[];n.push(0);for(var i,r,s=0,o=t.length;s<o;s++)if(t[s]!==-1){var a=n[n.length-1];if(t[a]<t[s])e[s]=a,n.push(s);else{for(i=0,r=n.length-1;i<r;){var d=(i+r)/2|0;t[n[d]]<t[s]?i=d+1:r=d}t[s]<t[n[i]]&&(i>0&&(e[s]=n[i-1]),n[i]=s)}}for(i=n.length,r=n[i-1];i-- >0;)n[i]=r,r=e[r];return n},_clear:function(){this.childKeys={},this.children.splice(0).forEach(function(t){t.$destroy()})},_insertChild:function(t,e){var n=dmx.Component("repeat-item"),i=new n(this.$template.cloneNode(!0),this,t);i.$nodes.forEach(function(t){e?this.childKeys[e]?this.$node.insertBefore(t,this.childKeys[e].$nodes[0]):console.warn("(insert) can not insert node before key "+e+"!"):this.$node.appendChild(t),i.$parse(t)},this),this.childKeys[t[this.props.key]]=i,this.children.push(i)},_moveChild:function(t,e){var n=this.childKeys[t];n?this.childKeys[e]?n.$nodes.forEach(function(t){this.$node.insertBefore(t,this.childKeys[e].$nodes[0])},this):n.$nodes.forEach(function(t){this.$node.appendChild(t)},this):console.warn("(move) child with key "+t+" not found!")},_removeChild:function(t){var e=this.childKeys[t];e?(e.$destroy(),this.children.splice(this.children.indexOf(e),1),delete this.childKeys[t]):console.warn("(remove) child with key "+t+" not found!")},_clone:function(t){return JSON.parse(JSON.stringify(t))}}),dmx.Component("repeat-item",{constructor:function(t,e,n,i){this.parent=e,this.bindings={},this.propBindings={},this.children=[],this.listeners=[],this.props={},this.data=n||{},this.seed=e.seed,this.name=i||"repeat",this.$nodes=[];for(var r=0;r<t.childNodes.length;r++)this.$nodes.push(t.childNodes[r])},$destroy:function(){this.dispatchEvent("destroy");for(var t=0;t<this.$nodes.length;t++){var e=document.createEvent("Event");e.initEvent("remove",!1,!0),this.$nodes[t].dispatchEvent(e)&&dmx.dom.remove(this.$nodes[t])}}}),dmx.Component("fetch",{constructor:function(t,e){this.fetch=dmx.debounce(this.fetch.bind(this)),dmx.BaseComponent.call(this,t,e)},initialData:{data:null,state:{executing:!1,uploading:!1,processing:!1,downloading:!1},uploadProgress:{position:0,total:0,percent:0},downloadProgress:{position:0,total:0,percent:0},lastError:{status:0,message:"",response:null}},attributes:{timeout:{type:Number,default:0},url:{type:String,default:""},params:{type:Object,default:{}},noload:{type:Boolean,default:!1},cache:{type:String,default:""},ttl:{type:Number,default:86400}},methods:{abort:function(){this.abort()},load:function(t,e){var n={};t&&(n.params=t),e&&(n.ttl=0),this.fetch(n)}},events:{start:Event,done:Event,error:Event,unauthorized:Event,forbidden:Event,abort:Event,success:Event,upload:ProgressEvent,download:ProgressEvent},$parseAttributes:function(t){dmx.BaseComponent.prototype.$parseAttributes.call(this,t),dmx.dom.getAttributes(t).forEach(function(t){"param"==t.name&&t.argument&&this.$addBinding(t.value,function(e){this.props.params[t.argument]=e})},this)},render:function(t){this.xhr=new XMLHttpRequest,this.xhr.addEventListener("load",this.onload.bind(this)),this.xhr.addEventListener("abort",this.onabort.bind(this)),this.xhr.addEventListener("error",this.onerror.bind(this)),this.xhr.addEventListener("timeout",this.ontimeout.bind(this)),this.xhr.addEventListener("progress",this.onprogress("download").bind(this)),this.xhr.upload&&this.xhr.upload.addEventListener("progress",this.onprogress("upload").bind(this)),dmx.BaseComponent.prototype.render.call(this,t),this.update({})},update:function(t){!this.props.noload&&this.props.url&&(t.url===this.props.url&&JSON.stringify(t.params)===JSON.stringify(this.props.params)||this.fetch())},abort:function(){this.xhr.abort()},fetch:function(t){this.xhr.abort(),t=dmx.extend(!0,this.props,t||{}),this._reset(),this.dispatchEvent("start");var e=(t.url.indexOf("?")>-1?"&":"?")+Object.keys(t.params).filter(function(e){return null!=t.params[e]},this).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t.params[e])},this).join("&");if(this._url=t.url+e,this.props.cache){var n=dmx.parse(this.props.cache+'.data["'+this._url+'"]',this);if(n){if(!(Date.now()-n.created>=1e3*t.ttl))return this.set("data",n.data),this.dispatchEvent("success"),void this.dispatchEvent("done");dmx.parse(this.props.cache+'.remove("'+this._url+'")',this)}}this.set("state",{executing:!0,uploading:!1,processing:!1,downloading:!1}),this.xhr.open("GET",this._url),this.xhr.timeout=1e3*t.timeout;try{this.xhr.send()}catch(t){this._done(t)}},_reset:function(){this.set({state:{executing:!1,uploading:!1,processing:!1,downloading:!1},uploadProgress:{position:0,total:0,percent:0},downloadProgress:{position:0,total:0,percent:0}})},_done:function(t){if(this._reset(),t)this.set("lastError",{status:0,message:t.message,response:null}),this.dispatchEvent("error");else{var e=this.xhr.responseText;try{e=JSON.parse(e)}catch(t){return this.set("lastError",{status:0,message:"Response was not valid JSON",response:e}),void this.dispatchEvent("error")}this.xhr.status<400?(this.set("data",e),this.dispatchEvent("success"),this.props.cache&&dmx.parse(this.props.cache+'.set("'+this._url+'", { data: data, created: '+Date.now()+" })",this)):400==this.xhr.status?this.dispatchEvent("invalid"):401==this.xhr.status?this.dispatchEvent("unauthorized"):403==this.xhr.status?this.dispatchEvent("forbidden"):(this.set("lastError",{status:this.xhr.status,message:this.xhr.statusText,response:e}),this.dispatchEvent("error"))}this.dispatchEvent("done")},onload:function(t){this._done()},onabort:function(t){this._reset(),this.dispatchEvent("abort"),this.dispatchEvent("done")},onerror:function(t){this._done({message:"Failed to execute"})},ontimeout:function(t){this._done({message:"Execution timeout"})},onprogress:function(t){return function(e){e.loaded=e.loaded||e.position;var n=e.lengthComputable?Math.ceil(e.loaded/e.total*100):0;this.set("state",{executing:!0,uploading:"upload"==t&&n<100,processing:"upload"==t&&100==n,downloading:"download"==t}),this.set(t+"Progress",{position:e.loaded,total:e.total,percent:n}),this.dispatchEvent(t,{lengthComputable:e.lengthComputable,loaded:e.loaded,total:e.total})}}}),dmx.Component("serverconnect",{extends:"fetch"}),dmx.Component("serverconnect-form",{extends:"form",initialData:{data:null,state:{executing:!1,uploading:!1,processing:!1,downloading:!1},uploadProgress:{position:0,total:0,percent:0},downloadProgress:{position:0,total:0,percent:0},lastError:{status:0,message:"",response:null}},attributes:{timeout:{type:Number,default:0},autosubmit:{type:Boolean,default:!1}},methods:{abort:function(){this.abort()}},events:{start:Event,done:Event,error:Event,unauthorized:Event,forbidden:Event,abort:Event,success:Event,upload:ProgressEvent,download:ProgressEvent},render:function(t){this.xhr=new XMLHttpRequest,this.xhr.addEventListener("load",this.onload.bind(this)),this.xhr.addEventListener("abort",this.onabort.bind(this)),this.xhr.addEventListener("error",this.onerror.bind(this)),this.xhr.addEventListener("timeout",this.ontimeout.bind(this)),this.xhr.addEventListener("progress",this.onprogress("download").bind(this)),this.xhr.upload&&this.xhr.upload.addEventListener("progress",this.onprogress("upload").bind(this)),t.dmxExtraData={},dmx.Component("form").prototype.render.call(this,t),this.props.autosubmit&&dmx.nextTick(function(){this.submit()},this)},abort:function(){this.xhr.abort()},_submit:function(t){this.xhr.abort();var e=this.$node.method.toUpperCase(),n=this.$node.action,i=null,r="";"GET"==e?(r=n.indexOf("?")>-1?"&":"?",r+=dmx.array(this.$node.elements).filter(function(e){return!(t&&t[e.name])&&!e.disabled&&("RADIO"!==e.type&&"CHECKBOX"!==e.type||e.checked)}).map(function(t){return escape(t.name)+"="+escape(t.value)}).join("&"),t&&Object.keys(t).forEach(function(e){Array.isArray(t[e])?t[e].forEach(function(t){r+="&"+escape(e)+"="+t}):r+="&"+escape(e)+"="+t[e]})):(i=new FormData(this.$node),t&&Object.keys(t).forEach(function(e){i.set(e,t[e])},this),this.$node.dmxExtraData&&Object.keys(this.$node.dmxExtraData).forEach(function(t){var e=this.$node.dmxExtraData[t];Array.isArray(e)?(/\[\]$/.test(t)||(t+="[]"),e.forEach(function(e){i.append(t,e)},this)):i.set(t,e)},this)),this._reset(),this.dispatchEvent("start"),this.xhr.open(e,n+r),this.xhr.timeout=1e3*this.props.timeout;try{this.xhr.send(i)}catch(t){this._done(t)}},_reset:function(){this.set({state:{executing:!1,uploading:!1,processing:!1,downloading:!1},uploadProgress:{position:0,total:0,percent:0},downloadProgress:{position:0,total:0,percent:0}})},_done:function(t){if(this._reset(),t)this.set("lastError",{status:0,message:t.message,response:null}),this.dispatchEvent("error");else{var e=this.xhr.responseText;try{e=JSON.parse(e)}catch(t){return this.set("lastError",{status:0,message:"Response was not valid JSON",response:e}),void this.dispatchEvent("error")}if(this.xhr.status<400)this.set("data",e),this.dispatchEvent("success");else if(400==this.xhr.status)if(this.dispatchEvent("invalid"),this.$node.action.indexOf("dmxConnect/")>-1&&e.form)for(var n in e.form){var i=document.querySelector('[name="'+n+'"]');i&&(i.setCustomValidity(e.form[n]),dmx.requestUpdate(),dmx.bootstrap3forms?dmx.validate.setBootstrapMessage(i,e.form[n]):dmx.validate.setErrorMessage(i,e.form[n]))}else console.warn("400 error, no form errors in response.",e);else 401==this.xhr.status?this.dispatchEvent("unauthorized"):403==this.xhr.status?this.dispatchEvent("forbidden"):(this.set("lastError",{status:this.xhr.status,message:this.xhr.statusText,response:e}),this.dispatchEvent("error"))}this.dispatchEvent("done")},onload:function(t){this._done()},onabort:function(t){this._reset(),this.dispatchEvent("abort"),this.dispatchEvent("done")},onerror:function(t){this._done({message:"Failed to execute"})},ontimeout:function(t){this._done({message:"Execution timeout"})},onprogress:function(t){return function(e){e.loaded=e.loaded||e.position;var n=e.lengthComputable?Math.ceil(e.loaded/e.total*100):0;this.set("state",{executing:!0,uploading:"upload"==t&&n<100,processing:"upload"==t&&100==n,downloading:"download"==t}),this.set(t+"Progress",{position:e.loaded,total:e.total,percent:n}),this.dispatchEvent(t,{lengthComputable:e.lengthComputable,loaded:e.loaded,total:e.total})}}}),dmx.Component("if",{attributes:{condition:{type:Boolean,default:!1}},render:function(t){for(this.nodes=[],this.template=document.createDocumentFragment();this.$node.firstChild;)this.template.appendChild(this.$node.firstChild);this.update({})},update:function(t){this.props.condition!=t.condition&&(this.props.condition?this._render():this._destroy())},_render:function(){var t=this.template.cloneNode(!0);this.nodes=Array.prototype.slice.call(t.childNodes),this.$node.appendChild(t),this.$parse()},_destroy:function(){this.bindings={},this.nodes.splice(0).forEach(function(t){t.dispatchEvent(new Event("remove",{cancelable:!0}))&&dmx.dom.remove(t)}),this.children.splice(0).forEach(function(t){t.$destroy()})}}),dmx.Component("datetime",{initialData:function(){return{datetime:this.datetime()}},attributes:{interval:{type:String,default:"seconds"},utc:{type:Boolean,default:!1}},render:function(){this.timer()},timer:function(){this.set("datetime",this.datetime()),requestAnimationFrame(this.timer.bind(this))},datetime:function(){var t,e,n,i,r,s,o=new Date,a=function(t,e){return("0000"+t).substr(-e)};this.props.utc?(t=o.getUTCFullYear(),e=o.getUTCMonth()+1,n=o.getUTCDate(),i=o.getUTCHours(),r=o.getUTCMinutes(),s=o.getUTCSeconds()):(t=o.getFullYear(),e=o.getMonth()+1,n=o.getDate(),i=o.getHours(),r=o.getMinutes(),s=o.getSeconds());var d=a(t,4)+"-"+a(e,2)+"-"+a(n,2),u=this.props.utc?"Z":"";switch(this.props.interval){case"days":return d+"T00:00:00"+u;case"hours":return d+"T"+a(i,2)+":00:00"+u;case"minutes":return d+"T"+a(i,2)+":"+a(r,2)+":00"+u}return d+"T"+a(i,2)+":"+a(r,2)+":"+a(s,2)+u}}),dmx.Attribute("bind","mounted",function(t,e){var n=e.argument,i=dmx.reToggleAttribute.test(n);this.$addBinding(e.value,function(e){if(i)t[n]=!!e;else{if("style"===n&&"object"==typeof e){for(var r in e)t.style[r]=e[r];return}t.setAttribute(n,e)}})}),dmx.Attribute("on","mounted",function(t,e){var n=this;dmx.eventListener(t,e.argument,function(t){var i=dmx.parse(e.value,dmx.DataScope({$event:t},n));if("string"==typeof i)try{i=new Function("event",i).call(this,t)}catch(t){console.warn('Error executing "'+i+'"',t)}return i},e.modifiers)}),dmx.Attribute("repeat","before",function(t,e){if(this.node!=t){var n=this,i=[],r=document.createDocumentFragment(),s=document.createComment("Repeat "+e.value);dmx.Component("repeat-item");t.parentNode.replaceChild(s,t),t.removeAttribute("dmx-repeat"),r.appendChild(t),this.add(e.argument||"repeat",[]),this.$addBinding(e.value,function(t){var e=dmx.Component("repeat-item"),o=[];if(t){if(Array.isArray(t))o=t.map(function(t){return"object"==typeof t?dmx.clone(t):{$value:t}});else switch(typeof t){case"number":for(var a=0;a<t;a++)o.push({$value:a+1});break;case"object":Object.keys(t).forEach(function(e){o.push({$key:e,$value:t[e]})})}o=o.map(function(t,e){return t.$index=e,t})}if(i.length>o.length&&i.splice(o.length).forEach(function(t){n.children.splice(n.children.indexOf(t),1),t.$destroy()}),i.length&&i.forEach(function(t,e){t.set(o[e])}),o.length>i.length){for(var d=document.createDocumentFragment(),u=i.length;u<o.length;u++){var h=new e(r.cloneNode(!0),n,o[u]);h.$nodes.forEach(function(t){d.appendChild(t),h.$parse(t)}),i.push(h),n.children.push(h)}s.parentNode.insertBefore(d,s)}})}}),dmx.Attribute("class","mounted",function(t,e){var n=e.argument;this.$addBinding(e.value,function(e,i){t.classList[e?"add":"remove"](n)})}),dmx.Attribute("hide","mounted",function(t,e){var n=t.style.display;this.$addBinding(e.value,function(e){t.style.display=e?"none":n})}),dmx.Attribute("show","mounted",function(t,e){var n=t.style.display;this.$addBinding(e.value,function(e){t.style.display=e?n:"none"})}),dmx.Attribute("html","mounted",function(t,e){this.$addBinding(e.value,function(e){null!=e&&(t.innerHTML=e)})}),dmx.Attribute("text","mounted",function(t,e){this.$addBinding(e.value,function(e){null!=e&&(t.innerText=e)})}),dmx.Attribute("style","mounted",function(t,e){var n=e.argument,i=e.modifiers.important?"important":"";this.$addBinding(e.value,function(e){null!=e&&t.style.setProperty(n,e,i)})}),dmx.Formatters("global",{json:function(t){return JSON.stringify(t)},log:function(t){return console.log(t),t}});
//# sourceMappingURL=maps/dmxAppConnect.js.map
